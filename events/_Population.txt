namespace = pop

#Pulse Event
country_event = {
	id = pop.0
	title = pop.0.t
	desc = pop.0.d
	picture = MERCHANTS_TALKING_eventPicture
	hidden = yes
	
	trigger = {
		had_global_flag = {
			flag = pop_pulse
			days = 365
		}
	}

	mean_time_to_happen = {
		days = 1
	}

    immediate = {
		clr_global_flag = pop_pulse
		set_global_flag = pop_pulse
		every_province = {
			if = {
				limit = {
					is_empty = no
				}
				set_variable = { which = fbp value = 0.1 }
				pops_growth_calc = { food_balance_percentage = fbp }
				set_variable = { which = fbp value = 0 }
        		update_pop_modifiers = yes
			}
		}
	}

	option = { #I am not a guinea pig!
		name = pop.1.op1
	}
}

#Testing Event
country_event = {
	id = pop.777
	title = pop.777.t
	desc = pop.777.d
	picture = MERCHANTS_TALKING_eventPicture

	is_triggered_only = yes

    immediate = {
		export_to_variable = {
            which = gov_cap
            value = modifier:governing_capacity
            who = ROOT
        }
		export_to_variable = {
            which = gov_cap_per
            value = trigger_value:governing_capacity_percentage
            who = ROOT
        }
	}

	option = { #I am not a guinea pig!
		name = pop.1.op1
		every_owned_province = {
			set_variable = { which = fbp value = 0.1 }
			pops_growth_calc = { food_balance_percentage = fbp }
		}
	}
	option = { #I am not a guinea pig!
		name = pop.1.op2
		every_owned_province = {
			set_variable = { which = fbp value = -0.1 }
			pops_growth_calc = { food_balance_percentage = fbp }
		}
	}
	option = { #I am not a guinea pig!
		name = pop.1.op3
		every_owned_province = {
			set_variable = { which = fbp value = -0.3 }
			pops_growth_calc = { food_balance_percentage = fbp }
		}
	}
}

#Census
country_event = {
	id = pop.1
	title = pop.1.t
	desc = pop.1.d
	picture = MERCHANTS_TALKING_eventPicture

	is_triggered_only = yes

    immediate = {
        hidden_effect = {
            Pops_GetNationalStats = yes
        }
    }

	option = { #Enable Mapmodes
		name = pop.1.op2
		country_event = { id = pop.2 }
	}
	option = { #Close
		highlight = yes
		name = pop.1.op1
	}
}

#Mapmodes
country_event = {
	id = pop.2
	title = pop.2.t
	desc = pop.2.d
	picture = MERCHANTS_TALKING_eventPicture

	is_triggered_only = yes

    immediate = {

    }

	option = { #Disable All Mapmodes
		name = pop.2.op1
		hidden_effect = {
			if = {
				limit = {
					has_global_flag = population_mm
				}
				clr_global_flag = population_mm
				every_province = {
					clear_map_pop_modifiers = yes
				}
			}
			if = {
				limit = {
					has_global_flag = urban_mm
				}
				clr_global_flag = urban_mm
				every_province = {
					clear_map_urban_pop_modifiers = yes
				}
			}
			if = {
				limit = {
					has_global_flag = rural_mm
				}
				clr_global_flag = rural_mm
				every_province = {
					clear_map_rural_pop_modifiers = yes
				}
			}
		}
	}
	option = { #Population
		name = pop.2.op2
		hidden_effect = {
			if = {
				limit = {
					has_global_flag = population_mm
				}
				clr_global_flag = population_mm
				every_province = {
					clear_map_pop_modifiers = yes
				}
			}
			else = {
				set_global_flag = population_mm
				every_province = {
					update_map_pop_modifiers = yes
				}
			}
		}
	}
	option = { #Urban Populations
		name = pop.2.op3
		hidden_effect = {
			if = {
				limit = {
					has_global_flag = urban_mm
				}
				clr_global_flag = urban_mm
				every_province = {
					clear_map_urban_pop_modifiers = yes
				}
			}
			else = {
				set_global_flag = urban_mm
				every_province = {
					update_map_urban_pop_modifiers = yes
				}
			}
		}
	}
	option = { #Rural Populations
		name = pop.2.op4
		hidden_effect = {
			if = {
				limit = {
					has_global_flag = rural_mm
				}
				clr_global_flag = rural_mm
				every_province = {
					clear_map_rural_pop_modifiers = yes
				}
			}
			else = {
				set_global_flag = rural_mm
				every_province = {
					update_map_rural_pop_modifiers = yes
				}
			}
		}
	}
	option = { #Back
		name = pop.2.b
		highlight = yes
		country_event = { id = pop.1 }
	}
}